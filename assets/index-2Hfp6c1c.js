import{H as fe,a as me,B as ye,R as Ae,l as ve,b as _e,L as ge,c as he}from"./feedBack-DOM0xDh3.js";import{i as Y,c as $,d as Q,r as Ne,h as S,F as w,m as be,T as le,a as Te,b as T,e as ee,f as g,g as V,o as A,j as p,k as I,l as u,u as b,w as d,t as O,n as X,p as U,q as k,s as M,_ as Ce,v as Ee}from"./index-DQDM4917.js";var Ie=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,a){l.__proto__=a}||function(l,a){for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(l[n]=a[n])},o(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(t,e);function l(){this.constructor=t}t.prototype=e===null?Object.create(e):(l.prototype=e.prototype,new l)}}(),x=function(){return x=Object.assign||function(o){for(var t,e=1,l=arguments.length;e<l;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o[a]=t[a])}return o},x.apply(this,arguments)},Ve=function(o){Ie(t,o);function t(){return o!==null&&o.apply(this,arguments)||this}return t.prototype.setAttributes=function(){var e=this.properties,l=e.width,a=e.height,n=e.radius;Y(l)||(this.width=l),Y(a)||(this.height=a),Y(n)||(this.radius=n)},t.prototype.getTextStyle=function(){var e=this.properties,l=e.refX,a=l===void 0?0:l,n=e.refY,m=n===void 0?0:n,h=e.textStyle,v=o.prototype.getTextStyle.call(this);return x(x(x({},v),$(h)||{}),{transform:"matrix(1 0 0 1 ".concat(a," ").concat(m,")")})},t.prototype.getNodeStyle=function(){var e=o.prototype.getNodeStyle.call(this),l=this.properties.style;return x(x({},e),$(l)||{})},t}(fe),oe={};function we(o,t){var e=o.type,l=o.component,a=o.effect,n=o.view,m=o.model;if(!e)throw new Error("You should specify type in config");oe[e]={component:l,effect:a},t.register({type:e,view:n||Oe,model:m||Ve})}var F=!1,R=Ne({});function xe(o,t,e,l,a){F&&(R[o]=be(Q({render:function(){return S(le,{to:e},[S(t,{node:l,graph:a})])},provide:function(){return{getNode:function(){return l},getGraph:function(){return a}}}})))}function Be(o){F&&delete R[o]}function te(){return F}function Se(){return F=!0,Q({props:{flowId:{type:String,required:!0}},setup:function(o){return function(){var t=[];return Object.keys(R).forEach(function(e){e.startsWith(o.flowId)&&t.push(R[e])}),S(w,{},t.map(function(e){return S(e)}))}}})}var De=function(){var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,a){l.__proto__=a}||function(l,a){for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(l[n]=a[n])},o(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");o(t,e);function l(){this.constructor=t}t.prototype=e===null?Object.create(e):(l.prototype=e.prototype,new l)}}(),Oe=function(o){De(t,o);function t(){return o!==null&&o.apply(this,arguments)||this}return t.prototype.getComponentContainer=function(){return this.root},t.prototype.targetId=function(){return"".concat(this.props.graphModel.flowId,":").concat(this.props.model.id)},t.prototype.componentWillUnmount=function(){o.prototype.componentWillUnmount.call(this),this.unmount()},t.prototype.setHtml=function(e){var l=document.createElement("div");l.className="custom-vue-node-content",this.root=l,e.appendChild(l),this.renderVueComponent()},t.prototype.confirmUpdate=function(e){},t.prototype.renderVueComponent=function(){var e;this.unmountVueComponent();var l=this.getComponentContainer(),a=this.props,n=a.model,m=a.graphModel;if(l){var h=oe[n.type].component;h&&(te()?xe(this.targetId(),h,l,n,m):(this.vm=Te({render:function(){return S(h,{node:n,graph:m})},provide:function(){return{getNode:function(){return n},getGraph:function(){return m}}}}),(e=this.vm)===null||e===void 0||e.mount(l)))}},t.prototype.unmountVueComponent=function(){var e=this.getComponentContainer();return this.vm&&(this.vm.unmount(),this.vm=null),e&&(e.innerHTML=""),e},t.prototype.unmount=function(){te()&&Be(this.targetId()),this.unmountVueComponent()},t}(me);class Ue extends ye{getEdgeStyle(){const t=super.getEdgeStyle();return t.stroke="#4e88f3",t.strokeWidth=1,t}}class ke extends Ae{getAnchorStyle(t){const e=super.getAnchorStyle(t);return e.stroke="rgb(24, 125, 255)",e.fill="#4E88F3",e.r=3,e.hover&&(e.hover.r=8,e.hover.fill="rgb(24, 125, 255)",e.hover.stroke="rgb(24, 125, 255)"),e}getOutlineStyle(){return{...super.getOutlineStyle(),stroke:"transparent",strokeDasharray:"0",strokeWidth:0}}getNodeStyle(){return{...super.getNodeStyle(),stroke:this.isSelected?"#1890ff":"#999",strokeDasharray:this.isSelected?"0":"3,2"}}}const Me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAvdJREFUeF7tmz2IE1EQx2deOBGEg2R3FYWDKwTFRkQ7G8VCBOUum0uwvsLawsJCRAsLCwttLSyFi4Q7sNFCBRsLRRFOvFIRkdvdQxE89JJ9mnCRuOHMzMsm9zaZtPufeW9+M29e3n4gjPkPxzx+EABSAQYE3KXgAPyCvQamLBON+CWac9+zjJhi9hJwa2svAfRR5jjGcgR4oXX8KCx514yd/MeQBcCtRQsAUB7ERHr5RMArgV+40UvHvU4GUFiMDqkYllsDNOKTYdl7xh2Mo3erwQnIqaedNlrh5Wi2cJPjp5eWDKBzQqHvkO16TWCr6wkA1b+Vh3ApLDq3TP0m7ciBbCeAJvDO5YeoLgbF/O00IGQGQDPYRA+6EPrO3X4hZApAEgJqKAcl50E/EDIHIAlBgz4V+e4TUwiZBNBVCaiOBMX8GxMImQWQhFDXavprKf+BCyHTALoaYy6eDGe87xwImQeQhLBj4ueuz+f2/aBCyAQAajAtHerXOzfWj3+qTK1T7EYPAACouH54dW7P2+wDoETQqWmfHRhnFWsrgBv7Zi/QLTsBQD+tSgVQS23Yp0HqvDp1bi2SJSA9wKYm2LyNZlLKbZu1Wecdx966JeDWoqt//ptd5wTR1iLA48B3TnNsBYB1TXBB5zgZ7NJWsMGxt64COJNPQysArFsCaaSV4UMqwLYKaG2DqCYpSUQdLwe+c4+i3UpjXQVw/gcgwPxIAtAA05SsKoDnIweAEniaGuuWQJrBUXwJANt2AUrW0tRIBdhWAZvb4LxJlhFgRY7D2b8fEJw1yX7bJvS9hxx76QG29QBO9tLQSgVIBciDEXkyJE+GbHoylEZn5/iQXUB2AdkFBrcLFBajKRXDR26X5azhfrT/fF+Qiw+GM94KxR/5FZmmM7cW3QeA8xTH26fBV6FfOEYdnwXAW/q2XzfqdwDgDHWAIeuqoe9UOGOyALQdt74f2oh3cwYatDaeUKvcFyqaczICMOhghulfAAyTto1jjX0F/AaPbaBfx6ODbAAAAABJRU5ErkJggg==",ne=()=>{const o=T({nodes:[{id:125,tableName:"DEPT_AUAZAEAHASBYAN_AUAZAEAJAJATAK_TEST_A",modeName:"TEST",x:724,y:-520,createTime:"2025-04-11 09:34:20",updateTime:null,list:[{fieldName:"ID",fieldType:"短整型（INT）",fieldAccuracy:"-",primary:!0,notNull:!0}],relateTable:null,relateTableId:null,relateField:null},{id:133,tableName:"DEPT_AUAZAEAHASBYAN_AUAZAEAJAJATAK_TEST_G",modeName:"TEST",x:484,y:44,createTime:"2025-04-11 10:19:23",updateTime:null,list:[{fieldName:"ID",fieldType:"短整型（INT）",fieldAccuracy:"-",primary:!0,notNull:!0}],relateTable:null,relateTableId:null,relateField:null},{id:134,tableName:"DEPT_AUAZAEAHASBYAN_AUAZAEAJAJATAK_TEST_H",modeName:"TEST",x:110,y:-518,createTime:"2025-04-15 10:27:14",updateTime:null,list:[{fieldName:"ID",fieldType:"短整型（INT）",fieldAccuracy:"-",primary:!0,notNull:!0},{fieldName:"STR",fieldType:"不定长字符串（VARCHAR）",fieldAccuracy:"64",primary:!1,notNull:!1},{fieldName:"DOUBO",fieldType:"精度浮点型（DECIMAL）",fieldAccuracy:"10,2",primary:!1,notNull:!1},{fieldName:"DATETIME",fieldType:"日期时间类型（DATETIME）",fieldAccuracy:"-",primary:!1,notNull:!1}],relateTable:null,relateTableId:null,relateField:null},{id:135,tableName:"DEPT_AUAZAEAHASBYAN_AUAZAEAJAJATAK_TEST_I",modeName:"TEST",x:1042,y:54,createTime:"2025-04-11 14:08:21",updateTime:null,list:[{fieldName:"TEST_I",fieldType:"短整型（INT）",fieldAccuracy:"-",primary:!0,notNull:!0}],relateTable:null,relateTableId:null,relateField:null}],edges:[{id:"f9494491-50c7-4e9c-82f5-b4b8a86cbc85",sourceAnchorId:"133_0",targetAnchorId:"125_2",sourceNodeId:133,targetNodeId:125,tableIds:"[125, 133, 134, 135]",ids:"[75, 95, 104]",idOnly:68,createBy:null,createTime:"2025-04-15 11:26:23",updateBy:null,updateTime:null,remark:null,isDeleted:0},{id:"7ab96332-61af-4810-99db-ebfe549e4eee",sourceAnchorId:"135_0",targetAnchorId:"125_2",sourceNodeId:135,targetNodeId:125,tableIds:"[125, 133, 134, 135]",ids:"[75, 95, 104]",idOnly:69,createBy:null,createTime:"2025-04-15 11:26:23",updateBy:null,updateTime:null,remark:null,isDeleted:0},{id:"2150a510-f38b-4afb-9cbd-581c8d73aa49",sourceAnchorId:"125_3",targetAnchorId:"134_1",sourceNodeId:125,targetNodeId:134,tableIds:"[125, 133, 134, 135]",ids:"[75, 95, 104]",idOnly:70,createBy:null,createTime:"2025-04-15 11:26:23",updateBy:null,updateTime:null,remark:null,isDeleted:0}]});return{options1:T([]),options2:[{label:"否",value:!1},{label:"是",value:!0}],options3:[{label:"否",value:!1},{label:"是",value:!0}],tableData:o}},Re={class:"CustomVueBox"},Qe={class:"Header"},Fe={class:"Header_Left"},je=["src"],Le={class:"Header_Title"},Je={class:"dialogBox"},He={class:"itemArr"},We={class:"itemBtn"},Pe={class:"itemForm"},Ye=Q({__name:"ProgressNode",setup(o){const{options1:t,options2:e,options3:l}=ne(),a=ee("getNode"),n=ee("getGraph"),m=a(),h=n(),v=T(),N=f=>{f.stopPropagation(),v.value.scrollTop+=f.deltaY},_=T([{fieldName:"",fieldType:null,primary:null,notNull:null,fieldAccuracy:null,scale:null}]),s=T(!1),y=T({modeName:"",tableName:"",relateTableId:null,relateField:null}),C=(f,i)=>{_.value=[...f.list],y.value={modeName:f.modeName,tableName:f.tableName},s.value=!0},ae=()=>{_.value.push({fieldName:"",fieldType:null,primary:null,notNull:null,fieldAccuracy:null,scale:null})},re=f=>{f.fieldAccuracy=null,f.scale=null},de=f=>{_.value.splice(f,1)},j=()=>{s.value=!1,y.value={},_.value=[]},ue=()=>{var f;(f=h.eventCenter)==null||f.emit("node:doEdit",{form:y.value,pojoList:_.value}),h.eventCenter.on("node:axiosStatus",i=>{i?j():ve("编辑失败","error")})},se=()=>{_e("您确定要移除当前项吗",null,async()=>{var f;(f=h.eventCenter)==null||f.emit("node:doDel",{data:m.properties.tableObject})})};return(f,i)=>{const z=g("el-tooltip"),L=g("el-table-column"),ie=g("el-table"),B=g("el-input"),G=g("el-form-item"),E=g("el-col"),K=g("el-row"),ce=g("el-form"),D=g("el-button"),J=g("el-option"),H=g("el-select"),pe=g("el-dialog");return A(),V(w,null,[p("div",Re,[p("div",Qe,[p("div",Fe,[p("img",{src:b(Me),alt:""},null,8,je),u(z,{effect:"dark",content:b(m).properties.tableObject.tableName,placement:"top"},{default:d(()=>[p("div",Le,O(b(m).properties.tableObject.tableName),1)]),_:1},8,["content"])]),u(z,{effect:"light",placement:"right"},{content:d(({})=>[p("div",null,[p("div",{class:"btn",onClick:i[0]||(i[0]=r=>C(b(m).properties.tableObject,"编辑"))},"编辑"),p("div",{class:"btn",onClick:se},"移除")])]),default:d(()=>[i[4]||(i[4]=p("span",{style:{"font-weight":"600"}},"...",-1))]),_:1})]),p("div",{ref_key:"box",ref:v,onWheel:N,class:"Content"},[u(ie,{data:b(m).properties.tableObject.list,stripe:"",style:{width:"100%"},class:"custom-table"},{default:d(()=>[u(L,{prop:"fieldName",label:"名称",align:"center"},{default:d(({row:r})=>[p("div",{style:X({color:r.primary?"red":""})},O(r.fieldName),5)]),_:1}),u(L,{prop:"fieldType",label:"类型",align:"center"},{default:d(({row:r})=>[p("div",{style:X({color:r.primary?"red":""})},O(r.fieldType),5)]),_:1}),u(L,{prop:"fieldAccuracy",label:"精度",align:"center"},{default:d(({row:r})=>[p("div",{style:X({color:r.primary?"red":""})},O(r.fieldAccuracy),5)]),_:1})]),_:1},8,["data"])],544),i[5]||(i[5]=p("div",{class:"Footer"},null,-1))]),(A(),I(le,{to:"body"},[u(pe,{modelValue:s.value,"onUpdate:modelValue":i[3]||(i[3]=r=>s.value=r),title:"编辑",class:"dialog",onClose:j},{footer:d(()=>[u(D,{onClick:j},{default:d(()=>i[8]||(i[8]=[M("取 消")])),_:1}),u(D,{type:"primary",onClick:ue},{default:d(()=>i[9]||(i[9]=[M("确认")])),_:1})]),default:d(()=>[p("div",Je,[u(ce,{model:y.value,"label-width":"110px","label-position":"top"},{default:d(()=>[u(K,{gutter:20},{default:d(()=>[u(E,{span:8},{default:d(()=>[u(G,{label:"模式名"},{default:d(()=>[u(B,{modelValue:y.value.modeName,"onUpdate:modelValue":i[1]||(i[1]=r=>y.value.modeName=r),placeholder:"请输入模式名",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1}),u(E,{span:8},{default:d(()=>[u(G,{label:"表名"},{default:d(()=>[u(B,{modelValue:y.value.tableName,"onUpdate:modelValue":i[2]||(i[2]=r=>y.value.tableName=r),placeholder:"请输入表名",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),p("div",He,[(A(!0),V(w,null,U(_.value,(r,W)=>(A(),V("div",{class:"item",key:W},[p("div",We,[W==_.value.length-1?(A(),I(D,{key:0,plain:"",icon:"Plus",type:"primary",size:"small",onClick:ae},{default:d(()=>i[6]||(i[6]=[M("添加")])),_:1})):k("",!0),_.value.length!=1?(A(),I(D,{key:1,plain:"",icon:"Delete",type:"danger",size:"small",onClick:P=>de(W)},{default:d(()=>i[7]||(i[7]=[M("删除")])),_:2},1032,["onClick"])):k("",!0)]),p("div",Pe,[u(K,{gutter:20},{default:d(()=>{var P,q,Z;return[u(E,{span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(B,{modelValue:r.fieldName,"onUpdate:modelValue":c=>r.fieldName=c,placeholder:"请输入字段名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(E,{span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(H,{modelValue:r.fieldType,"onUpdate:modelValue":c=>r.fieldType=c,placeholder:"请选择字段类型",clearable:"",filterable:"",onChange:c=>re(r)},{default:d(()=>[(A(!0),V(w,null,U(b(t),c=>(A(),I(J,{label:c.dictName,value:c.id},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),u(E,{span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(H,{modelValue:r.primary,"onUpdate:modelValue":c=>r.primary=c,placeholder:"请选择是否主键",clearable:""},{default:d(()=>[(A(!0),V(w,null,U(b(e),c=>(A(),I(J,{label:c.label,value:c.value},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),u(E,{span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(H,{modelValue:r.notNull,"onUpdate:modelValue":c=>r.notNull=c,placeholder:"请选择是否非空",clearable:""},{default:d(()=>[(A(!0),V(w,null,U(b(l),c=>(A(),I(J,{label:c.label,value:c.value},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),((P=r.fieldType)==null?void 0:P.slice(-1))==1||((q=r.fieldType)==null?void 0:q.slice(-1))==2?(A(),I(E,{key:0,span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(B,{modelValue:r.fieldAccuracy,"onUpdate:modelValue":c=>r.fieldAccuracy=c,placeholder:"请输入精度"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):k("",!0),((Z=r.fieldType)==null?void 0:Z.slice(-1))==2?(A(),I(E,{key:1,span:8,style:{"margin-bottom":"10px"}},{default:d(()=>[u(B,{modelValue:r.scale,"onUpdate:modelValue":c=>r.scale=c,placeholder:"请输入标度"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):k("",!0)]}),_:2},1024)])]))),128))])])]),_:1},8,["modelValue"])]))],64)}}}),Xe=Ce(Ye,[["__scopeId","data-v-0c6820f7"]]),Ke=Q({__name:"index",setup(o){const{tableData:t}=ne(),e=T(null),l=Se(),a=T(""),n=T();Ee(()=>{var v,N,_;e.value&&(n.value=new ge({container:e.value,grid:!0,nodeTextEdit:!1,edgeTextEdit:!1,zoom:{min:.2,max:2,size:.1}}),we({type:"custom-vue-node",component:Xe,model:ke},n.value),(v=n.value)==null||v.register({type:"CustomNodeLine",view:he,model:Ue}),(N=n.value)==null||N.graphModel.transformModel.zoom(.5),n.value.graphModel.setDefaultEdgeType("CustomNodeLine"),h(n),n.value.render({nodes:[],edges:[]}),t.value.nodes.forEach((s,y)=>{var C;(C=n.value)==null||C.addNode({id:s.id,type:"custom-vue-node",x:s.x,y:s.y,properties:{tableObject:{list:s.list,modeName:s.modeName,tableName:s.tableName,id:s.id},width:480,height:280}})}),t.value.edges.forEach(s=>{var y;(y=n.value)==null||y.addEdge({id:s.id,sourceNodeId:s.sourceNodeId,targetNodeId:s.targetNodeId,sourceAnchorId:s.sourceAnchorId,targetAnchorId:s.targetAnchorId,type:"CustomNodeLine"})}),(_=n.value)==null||_.translateCenter())});const m=v=>{var N;(N=n.value)==null||N.graphModel.eventCenter.emit("node:axiosStatus",v)},h=v=>{var N,_;v.value.on("graph:rendered",({graphModel:s})=>{a.value=s.flowId}),(N=v.value)==null||N.graphModel.eventCenter.on("node:doEdit",s=>{const{form:y,pojoList:C}=s;console.log({form:y,pojoList:C},"编辑"),m(!0)}),(_=v.value)==null||_.graphModel.eventCenter.on("node:doDel",s=>{const{data:{modeName:y,tableName:C}}=s;console.log({modeName:y,tableName:C},"移除"),m(!0)})};return(v,N)=>(A(),V(w,null,[p("div",{ref_key:"containerRef",ref:e,class:"viewport"},null,512),u(b(l),{"flow-id":a.value},null,8,["flow-id"])],64))}});export{Ke as default};
